(function(){function k(){axios.get("/site-settings").then(function(n){pKeys=n.data;g()})}function d(){var t=n.channels.map(function(n){return{value:n.name,text:n.name}});showBootboxSelectPrompt("Switch chat user/channel.",t,"sm",i,function(n){n&&ot(n)})}function g(){axios.get(`/api/sessions/pubnub-user/${v}`).then(function(t){n=t.data;rt();i=ft();st()}).catch(function(n){console.error(n.response.data)})}function nt(t){axios.get(`/api/sessions/teammembers/${t.channel}`).then(function(i){n.teamMembers.push.apply(n.teamMembers,i.data);var r=h(t);f(r)}).catch(function(n){console.error(n.response.data)})}function y(n){var r={channel:i.name,message:n};t.publish(r,function(n,t){console.log(n,t)})}function tt(){var i=n.channels.map(function(n){return n.Name});t.fetchMessages({channels:i,end:o,count:25},(n,t)=>{var r,i,u;if(t){r=t.channels;i=[];for(const n in r)i.push.apply(i,r[n]);i=_.sortBy(i,"timetoken");console.log(i);u="";i.forEach(function(n){u+=it(n)});$(".chat-box li").remove();f(u)}})}function it(t){var f="",e,u,i,o;return t.message.publisher===n.uuId?(t.channel==="All"?(i=r("all-panelists"),e=""):(i=r(t.message.subscriber),e=`<span class="text-danger">(privately)</span>`),f=`<li>
                    <p>
                        <span class="text-muted">From Me to</span>&nbsp;
                        <span style="cursor: pointer;" class="btn-link" onclick="updateActiveChannelGlobal('${i.id}')">${i.text}: </span>${e}
                        <br />
                        ${t.message.text}
                        <br>
                        <small>${c(t.timetoken)}</small>
                    </p>
                </li>`):(u="",t.channel==="All"?(i=r("all-panelists"),u=`<span style="cursor:pointer;" class="btn-link" onclick="updateActiveChannelGlobal('${i.id}')" > ${i.text}:</span>`):u=`<span class="text-primary">Me:</span><span class="text-danger">(privately)</span>`,o=r(t.message.publisher),f=`<li>
                <p>
                    From <span style="cursor: pointer;" class="btn-link" onclick="updateActiveChannelGlobal('${o.id}')">${o.text}:</span>
                    &nbsp;to&nbsp;${u}
                    <br />
                    ${t.message.text}
                    <br>
                    <small>${c(t.timetoken)}</small>
                </p>
            </li>`),f}function rt(){t=new PubNub({publishKey:pKeys.publishKey,subscribeKey:pKeys.subscribeKey,uuid:n.uuId});t.addListener({status:function(n){n.category==="PNConnectedCategory"},message:function(t){var i,u;if(o||(localStorage.setItem("endTimeToken",t.timetoken),o=t.timetoken),t.publisher!==n.uuId)if(i=r(t.publisher),i){if(t.message.subscriber&&n.uuId!==t.message.subscriber)return;u=h(t);f(u)}else n.channels.push({name:t.channel}),nt(t)},presence:function(n){var t=n.occupancy},membership:function(){},user:function(){}});w();p();l&&tt()}function p(){t.hereNow({channels:["All"],includeState:!0},function(n,t){var i,u,o,f,s,h;n.statusCode===200&&(i=t.channels.All,u=[],u.push({id:"",text:""}),o="",i.occupants.forEach(function(n){var t=r(n.uuid);t&&(u.push(t),o+=`<li class="list-inline-item text-primary border">${t.text}</li>`)}),f=e.val(),initSelect2(e,u,!1,"Select Team."),f==="all-panelists"?(e.val("all-panelists").trigger("change"),$("#chat-mode").text("(Publically)")):(s=r(f),s?(e.val(f).trigger("change"),$("#chat-mode").text("(Privately)")):(e.val("all-panelists").trigger("change"),$("#chat-mode").text("(Publically)"))),h=i.occupancy>0?i.occupancy-1:0,$("#totalOccupancy").html(h),$("#ul-online-users").empty().append(onlineUsersMarkup))})}function ut(n){t.subscribe({channels:[n],withPresence:!0})}function w(){t.subscribe({channels:n.channels.map(function(n){return n.name}),withPresence:!0})}function s(n){return`<li class="message-item me">
                <img src="https://via.placeholder.com/43x43" class="img-xs rounded-circle" alt="avatar">
                <div class="content">
                    <div class="message">
                        <div class="bubble">
                            <p>${n.text}</p>
                        </div>
                        <span>${getChatTime(new Date)}</span>
                    </div>
                </div>
            </li>`}function h(n){return`<li class="message-item friend">
                <img src="https://via.placeholder.com/43x43" class="img-xs rounded-circle" alt="avatar">
                <div class="content">
                    <div class="message">
                        <div class="bubble">
                            <p>${n.message.text}</p>
                        </div>
                        <span>${c(n.timetoken)}</span>
                    </div>
                </div>
            </li>`}function f(n){$(".messages").append(n);a.update()}function ft(){return n.channels.find(function(n){return n.isDefault})}function et(t){return n.channels.find(function(n){return n.name===t})}function r(t){return n.teamMembers.find(function(n){return n.uuId===t})}function ot(n){i=n;$("#d-channel").text(n)}function c(n){var t=parseInt(n/1e7),i=new Date(t*1e3);return getChatTime(i)}function st(){n.events.forEach(function(n){var i="",t="";n.cto&&(t+=`<div class="col-12">
                        <div class="py-3">
                            <h5>CTO</h5>
                            <p>${n.cto}</p>
                        </div>
                    </div>`);n.speakers&&(t+=`<div class="col-12">
                        <div class="py-3">
                            <h5>Speakers</h5>
                            <p>${n.speakers}</p>
                        </div>
                    </div>`);n.sponsors&&(t+=`<div class="col-12">
                        <div class="py-3">
                            <h5>Sponsors</h5>
                            <p>${n.sponsors}</p>
                        </div>
                    </div>`);var r="",u=[],f=[];n.resources.length>0&&(r=`<div class="col-12 py-3">
                        <h5>Resources</h5>
                        <input id="previewFile-${n.id}" name="previewFile" type="file" multiple disabled>
                    </div>`,n.resources.forEach(function(n){u.push(`${appConstants.BASE_URL}resource.filePath`);f.push({type:n.previewType,caption:n.title,key:n.id})}));i+=`<div class="col-md-6 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-baseline">
                                <h3 class="card-title mb-3">${n.eventType}</h3>
                            </div>
                            <div class="row">
                                <div class="media d-block d-sm-flex">
                                    <img src="${appConstants.BASE_URL}/nobleui/assets/images/placeholder.jpg" class="wd-100p wd-sm-200 mb-3 mb-sm-0 mr-3" alt="...">
                                    <div class="media-body">
                                        <h5 class="card-title mt-0">${n.title} <small>${formatDateToHHMMADMMMYYYY(n.eventDate)}</small></h5>
                                        <p>${n.description}</p>
                                    </div>
                                </div>
                                ${t}
                                ${r}
                            </div>
                        </div>
                    </div>
                </div>`;$("#eventInfo").append(i);n.resources.length>0&&$(`#previewFile-${n.id}`).fileinput({showUpload:!1,theme:"fa",initialPreview:u,initialPreviewAsData:!0,initialPreviewFileType:"image",initialPreviewConfig:f})})}var t={},n={},i={},u={text:"",publisher:"",subscriber:""},e,b,o,l=!1,a,v;$(function(){localStorage.getItem("endTimeToken")&&(o=localStorage.getItem("endTimeToken"),l=!0);v=$("#eventId").val();k();var t=(new signalR.HubConnectionBuilder).withUrl("/channelHub").build();t.on("channelAdded",function(t){var i=et(t);i||(n.channels.push(channel),ut(t))});t.start().then(function(){console.log("SignalR Started")}).catch(showResponseError);$("#txt-message").keyup(function(t){var i,r;if(t.preventDefault(),(t.keyCode||t.which)==13){if(i=this.value?this.value.trim():this.value,!i)return;u={text:i,publisher:n.uuId};y(u);this.value="";r=s(u);f(r)}});$("#btn-send").on("click",function(t){var i,r;(t.preventDefault(),i=$("#txt-new-message").val(),i)&&(u={text:i,publisher:n.uuId},y(u),$("#txt-new-message").val(""),r=s(u),f(r))});$(".chat-content .chat-body").length&&(a=new PerfectScrollbar(".chat-content .chat-body"));setInterval(p,15e3);$(".chat-content").toggleClass("show");$("#swith-user").on("click",d)})})();