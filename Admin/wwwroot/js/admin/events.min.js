(function(){function h(){r.bootstrapTable("destroy");r.bootstrapTable({toolbar:"#tblToolbar",search:!0,searchOnEnterKey:!0,showSearchClearButton:!0,showExport:!0,showColumns:!0,exportTypes:"['csv', 'excel']",pagination:!0,sidePagination:"server",pageList:"[10, 20, 50, 100, 200]",cache:!1,sortable:!0,columns:[{sortable:!1,searchable:!1,title:"Actions",align:"center",width:125,formatter:function(){return`<a class="btn btn-primary btn-sm edit" title="Edit Event">
                              <i class="fa fa-edit" aria-hidden="true"></i> 
                            </a>
                            <a class="btn btn-primary btn-sm share" title="Share Event with Guest">
                              <i class="fa fa-share" aria-hidden="true"></i> 
                            </a>
                            <a class="btn btn-danger btn-sm remove" href="javascript:" title="Delete Event">
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            </a>`},events:{"click .edit":a,"click .share":y,"click .remove":v}},{sortable:!0,searchable:!0,field:"title",title:"Title",width:100},{sortable:!0,searchable:!0,field:"speakers",title:"Speakers",width:100},{sortable:!0,searchable:!0,field:"sponsors",title:"Sponsors",width:100},{sortable:!0,searchable:!0,field:"eventDate",title:"Event Date",formatter:function(n){return formatDateToMMDDYYYY(n)},width:100},{sortable:!0,searchable:!0,field:"meetingId",title:"Meeting Id",width:100},{sortable:!0,searchable:!0,field:"meetingPassword",title:"Meeting Pwd",width:100},{sortable:!0,searchable:!0,field:"description",title:"Description",width:100}],onPageChange:function(n,i){var r=(n-1)*i,f=i;(t.offset!=r||t.limit!=f)&&(t.offset=r,t.limit=f,u())},onSort:function(n,i){t.sort=n;t.order=i;t.offset=0;u()},onRefresh:function(){c();u()},onSearch:function(n){t.filter=n;u()}})}function u(){r.bootstrapTable("showLoading");var n=$.param(t),i=`/api/events?${n}`;axios.get(i).then(function(n){r.bootstrapTable("load",n.data);r.bootstrapTable("hideLoading")}).catch(showResponseError)}function c(){t.offset=0;t.limit=10;t.filter="";t.sort="title";t.order=""}function l(){axios.get(`/api/events/new`).then(function(n){setFormData(i,n.data);$("#event-modal-label").text("Add new Event");i.trigger("reset");$("#fg-session").addClass("d-none");$("#fg-speaker").addClass("d-none");$("#fg-sponsor").addClass("d-none");$("#fg-presenter").addClass("d-none");$("#fg-cto").addClass("d-none");o();$("#event-modal").modal("show")}).catch(showResponseError)}function a(n,t,r){n.preventDefault();$("#fg-createZoomMeeting").hide();axios.get(`/api/events/${r.id}`).then(function(n){setFormData(i,n.data,!0);$("#event-modal-label").text("Edit Event");$("#event-modal").modal("show")}).catch(showResponseError)}function v(n,t,i){n.preventDefault();showBootboxConfirm("Delete Event","Are you sure you want to delete this?",function(n){n&&axios.delete(`/api/events/${i.id}`).then(function(){toastr.success(appConstants.ITEM_DELETED_SUCCESSFULLY);r.bootstrapTable("refresh")}).catch(showResponseError)})}function y(n,t,i){n.preventDefault();var r=i.id,u=i.title;axios.get("/api/select-options/guest").then(function(n){showBootboxSelect2MultipleDialog("Select one or many guest.","GuestIds","Share event link to one or more guest.",n.data,!0,function(n){if(n){var t=n.map(function(n){return n.text}),i={guestEmail:t,eventId:r,eventTitle:u};axios.post("/api/events/share-link",i).then(function(){toastr.success("Link to this event is shared to the selected guests.")}).catch(showResponseError)}})}).catch(showResponseError)}function p(t){t.params.name!=="unselect"&&(t.params.data.text==eventTypeConstants.EDC_PANEL?($("#fg-speaker").removeClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none"),n=0,f(),$("#resourceDiv").removeClass("d-none")):t.params.data.text==eventTypeConstants.EDC_TEAM_SESSION?($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").removeClass("d-none"),$("#fg-cto").removeClass("d-none"),n=0,f(),$("#resourceDiv").removeClass("d-none")):t.params.data.text==eventTypeConstants.EDC_NETWORKING?($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none"),n=0,o()):($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").removeClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none"),n=0,f(),$("#resourceDiv").removeClass("d-none")))}function w(n){axios.get(`/api/select-options/related-events?date=${n.currentTarget.value}`).then(function(n){initSelect2($("#sessionId"),n.data);$("#fg-session").removeClass("d-none")}).catch(showResponseError)}function f(){if(n.length===10)return toastr.warning("You can only add up to 10 files.");n++;var t=`<h6>Resource ${n}</h6>
            <div class="form-group row">
                <div class="col">
                    <input type="text" id="resourceTitle-${n}" name="resourceTitle-${n}" class="form-control" placeholder="Resource Title">
                </div>
                <div class="col">
                    <input type="text" id="resourceDescription-${n}" name="resourceDescription-${n}" class="form-control" placeholder="Resource Description">
                </div>
            </div>
            <div class="form-group row">
                <div class="col">
                    <input type="file" accept="image/jpeg,image/gif,image/png,application/pdf" id="resourceFile-${n}" name="resourceFile-${n}" class="form-control file">
                </div>
            </div>`;$("#resource-container").append(t);$(".file").fileinput({showPreview:!1,showUpload:!1,theme:"fa"})}function b(n){n&&n.preventDefault();f()}function o(){n=0;$("#resource-container").empty();$("#resourceDiv").addClass("d-none")}function k(t){var f,o,l,r,y,p,a,v,w,h,k,c;if(t.preventDefault(),f=$(this),o=f.html(),setLoadingButton(f),initializeValidation(i,e),l=isValidForm(i,e),l){showValidationToast(l);resetLoadingButton(f,o);return}if(resetValidationState(i),r=formDataToJson(i),r.id=parseInt(r.id),isNaN(r.id)&&(r.id=0),r.eventTypeId=parseInt(r.eventTypeId),r.cohortId=parseInt(r.cohortId),y=parseInt(r.presenterId),isNaN(y)&&(r.presenterId=0),p=parseInt(r.ctoId),isNaN(p)&&(r.ctoId=0),a=$("#speakers").select2("data"),a&&(r.speakers=a.map(function(n){return{id:n.id,text:n.text}})),v=$("#sponsors").select2("data"),v&&(r.sponsors=v.map(function(n){return{id:n.id,text:n.text}})),w=$("#eventTypeId").select2("data")[0].text,w!=eventTypeConstants.EDC_NETWORKING)for(r.resources=[],h=1;h<=n;h++){var g=$(`#resourceTitle-${h}`).val(),nt=$(`#resourceDescription-${h}`).val(),b=$(`#resourceFile-${h}`)[0].files[0];b&&(k={title:g,description:nt,file:b},r.resources.push(k))}c=new FormData;s(c,r);const d={headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}};r.id<=0?axios.post("/api/events",c,d).then(function(){resetLoadingButton(f,o);$("#event-modal").modal("hide");u();toastr.success("Event created successfully!")}).catch(function(n){resetLoadingButton(f,o);showResponseError(n)}):axios.put("/api/events",c,d).then(function(){resetLoadingButton(f,o);$("#event-modal").modal("hide");u();toastr.success("Event updated successfully!")}).catch(function(n){resetLoadingButton(f,o);showResponseError(n)})}function s(n,t,i){if(!t||typeof t!="object"||t instanceof Date||t instanceof File||t instanceof Blob){const r=t==null?"":t;t instanceof File?n.append("files",t):n.append(i,r)}else Object.keys(t).forEach(r=>{s(n,t[r],i?`${i}[${r}]`:r)})}var r,i,n=0,e={title:{presence:!0,length:{maximum:100}},cohortId:{presence:!0},eventDate:{presence:!0}},t={offset:0,limit:10,sort:"title",order:"",filter:""};$(document).ready(function(){r=$("#tblList");h();u();i=$("#event-form");$("#add-new-event").click(l);$("#eventTypeId").on("select2:select select2:unselecting",p);$("#eventDate").on("change",w);$("#addMoreResource").click(b);$("#btn-save-event").click(k)})})();