(function(){function s(){r.bootstrapTable("destroy");r.bootstrapTable({toolbar:"#tblToolbar",search:!0,searchOnEnterKey:!0,showSearchClearButton:!0,showExport:!0,showColumns:!0,exportTypes:"['csv', 'excel']",pagination:!0,sidePagination:"server",pageList:"[10, 20, 50, 100, 200]",cache:!1,sortable:!0,columns:[{sortable:!1,searchable:!1,title:"Actions",align:"center",width:125,formatter:function(){return`<a class="btn btn-primary btn-sm edit" title="Edit Event">
                              <i class="fa fa-edit" aria-hidden="true"></i> 
                            </a>
                            <a class="btn btn-primary btn-sm share" title="Share Event with Guest">
                              <i class="fa fa-share" aria-hidden="true"></i> 
                            </a>
                            <a class="btn btn-danger btn-sm remove" href="javascript:" title="Delete Event">
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            </a>`},events:{"click .edit":l,"click .share":v,"click .remove":a}},{sortable:!0,searchable:!0,field:"title",title:"Title",width:100},{sortable:!0,searchable:!0,field:"speakers",title:"Speakers",width:100},{sortable:!0,searchable:!0,field:"sponsors",title:"Sponsors",width:100},{sortable:!0,searchable:!0,field:"eventDate",title:"Event Date",formatter:function(n){return formatDateToMMDDYYYY(n)},width:100},{sortable:!0,searchable:!0,field:"meetingId",title:"Meeting Id",width:100},{sortable:!0,searchable:!0,field:"meetingPassword",title:"Meeting Pwd",width:100},{sortable:!0,searchable:!0,field:"description",title:"Description",width:100}],onPageChange:function(t,i){var r=(t-1)*i,f=i;(n.offset!=r||n.limit!=f)&&(n.offset=r,n.limit=f,u())},onSort:function(t,i){n.sort=t;n.order=i;n.offset=0;u()},onRefresh:function(){h();u()},onSearch:function(t){n.filter=t;u()}})}function u(){r.bootstrapTable("showLoading");var t=$.param(n),i=`/api/events?${t}`;axios.get(i).then(function(n){r.bootstrapTable("load",n.data);r.bootstrapTable("hideLoading")}).catch(showResponseError)}function h(){n.offset=0;n.limit=10;n.filter="";n.sort="title";n.order=""}function c(){axios.get(`/api/events/new`).then(function(n){setFormData(i,n.data);$("#event-modal-label").text("Add new Event");i.trigger("reset");$("#fg-session").addClass("d-none");$("#fg-speaker").addClass("d-none");$("#fg-sponsor").addClass("d-none");$("#fg-presenter").addClass("d-none");$("#fg-cto").addClass("d-none");e();$("#event-modal").modal("show")}).catch(showResponseError)}function l(n,t,r){n.preventDefault();$("#fg-createZoomMeeting").hide();axios.get(`/api/events/${r.id}`).then(function(n){console.log(n.data);setFormData(i,n.data,!0);$("#event-modal-label").text("Edit Event");$("#event-modal").modal("show")}).catch(showResponseError)}function a(n,t,i){n.preventDefault();showBootboxConfirm("Delete Event","Are you sure you want to delete this?",function(n){n&&axios.delete(`/api/events/${i.id}`).then(function(){toastr.success(appConstants.ITEM_DELETED_SUCCESSFULLY);r.bootstrapTable("refresh")}).catch(showResponseError)})}function v(n,t,i){n.preventDefault();var r=i.id,u=i.title;axios.get("/api/select-options/guest").then(function(n){showBootboxSelect2MultipleDialog("Select one or many guest.","GuestIds","Share event link to one or more guest.",n.data,!0,function(n){if(n){var t=n.map(function(n){return n.text}),i={guestEmails:t,eventId:r,eventTitle:u};axios.post("/api/events/share-link",i).then(function(){toastr.success("Link to this event is shared to the selected guests.")}).catch(showResponseError)}})}).catch(showResponseError)}function y(n){n.params.name!=="unselect"&&(t=0,n.params.data.text==eventTypeConstants.EDC_NETWORKING?($("#resourceDiv").addClass("d-none"),e()):$("#resourceDiv").removeClass("d-none"),n.params.data.text==eventTypeConstants.EDC_PANEL?($("#fg-speaker").removeClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none")):n.params.data.text==eventTypeConstants.EDC_TEAM_SESSION?($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").removeClass("d-none"),$("#fg-cto").removeClass("d-none")):n.params.data.text==eventTypeConstants.EDC_NETWORKING?($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").addClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none")):($("#fg-speaker").addClass("d-none"),$("#fg-sponsor").removeClass("d-none"),$("#fg-presenter").addClass("d-none"),$("#fg-cto").addClass("d-none")))}function p(n){axios.get(`/api/select-options/related-events?date=${n.currentTarget.value}`).then(function(n){initSelect2($("#sessionId"),n.data);$("#fg-session").removeClass("d-none")}).catch(showResponseError)}function w(){if(t.length===10)return toastr.warning("You can only add up to 10 files.");t++;var n=`<h6>Resource ${t}</h6>
            <div class="form-group row">
                <div class="col">
                    <input type="text" id="resourceTitle-${t}" name="resourceTitle-${t}" class="form-control" placeholder="Resource Title">
                </div>
                <div class="col">
                    <input type="text" id="resourceDescription-${t}" name="resourceDescription-${t}" class="form-control" placeholder="Resource Description">
                </div>
            </div>
            <div class="form-group row">
                <div class="col">
                    <input type="file" accept="image/jpeg,image/gif,image/png,application/pdf" id="resourceFile-${t}" name="resourceFile-${t}" class="form-control file">
                </div>
            </div>`;$("#resource-container").append(n);$(".file").fileinput({showPreview:!1,showUpload:!1,theme:"fa"})}function b(n){n&&n.preventDefault();w()}function e(){t=0;$("#resource-container").empty();$("#resourceDiv").addClass("d-none")}function k(n){var e,s,l,r,y,p,a,v,w,h,k,c;if(n.preventDefault(),e=$(this),s=e.html(),setLoadingButton(e),initializeValidation(i,f),l=isValidForm(i,f),l){showValidationToast(l);resetLoadingButton(e,s);return}if(resetValidationState(i),r=formDataToJson(i),r.id=parseInt(r.id),isNaN(r.id)&&(r.id=0),r.eventTypeId=parseInt(r.eventTypeId),r.cohortId=parseInt(r.cohortId),y=parseInt(r.presenterId),isNaN(y)&&(r.presenterId=0),p=parseInt(r.ctoId),isNaN(p)&&(r.ctoId=0),a=$("#speakerIds").select2("data"),a&&(r.speakers=a.map(function(n){return{id:n.id,text:n.text}})),v=$("#sponsorIds").select2("data"),v&&(r.sponsors=v.map(function(n){return{id:n.id,text:n.text}})),w=$("#eventTypeId").select2("data")[0].text,w!=eventTypeConstants.EDC_NETWORKING)for(r.resources=[],h=1;h<=t;h++){var g=$(`#resourceTitle-${h}`).val(),nt=$(`#resourceDescription-${h}`).val(),b=$(`#resourceFile-${h}`)[0].files[0];b&&(k={title:g,description:nt,file:b},r.resources.push(k))}c=new FormData;o(c,r);const d={headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+localStorage.getItem("token")}};r.id<=0?axios.post("/api/events",c,d).then(function(){toastr.success("Event created successfully!");resetLoadingButton(e,s);$("#event-modal").modal("hide");u()}).catch(function(n){resetLoadingButton(e,s);showResponseError(n)}):axios.put("/api/events",c,d).then(function(){toastr.success("Event updated successfully!");resetLoadingButton(e,s);$("#event-modal").modal("hide");u()}).catch(function(n){resetLoadingButton(e,s);showResponseError(n)})}function o(n,t,i){if(!t||typeof t!="object"||t instanceof Date||t instanceof File||t instanceof Blob){const r=t==null?"":t;t instanceof File?n.append("files",t):n.append(i,r)}else Object.keys(t).forEach(r=>{o(n,t[r],i?`${i}[${r}]`:r)})}var r,i,t=0,f={title:{presence:!0,length:{maximum:100}},cohortId:{presence:!0},eventDate:{presence:!0}},n={offset:0,limit:10,sort:"title",order:"",filter:""};$(document).ready(function(){r=$("#tblList");s();u();i=$("#event-form");$("#add-new-event").click(c);$("#eventTypeId").on("select2:select select2:unselecting",y);$("#eventDate").on("change",p);$("#addMoreResource").click(b);$("#btn-save-event").click(k)})})();