(function(){function h(){i.bootstrapTable("destroy");i.bootstrapTable({toolbar:"#tblToolbar",search:!0,searchOnEnterKey:!0,showSearchClearButton:!0,showExport:!0,showColumns:!0,exportTypes:"['csv', 'excel']",pagination:!0,sidePagination:"server",pageList:"[10, 20, 50, 100, 200]",cache:!1,sortable:!0,columns:[{sortable:!1,searchable:!1,title:"Actions",align:"center",width:125,formatter:function(){return`<a class="btn btn-primary btn-sm edit"  title="Edit Poll">
                              <i class="fa fa-edit" aria-hidden="true"></i> 
                            </a>
                            <a class="btn btn-danger btn-sm ml-2 remove" href="javascript:" title="Delete Poll">
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            </a>`},events:{"click .edit":function(n,t,i){n.preventDefault();l(i.id)},"click .remove":function(n,t,r){n.preventDefault();showBootboxConfirm("Delete Poll","Are you sure you want to delete this?",function(n){n&&axios.delete(`/api/polls/${r.id}`).then(function(){toastr.success(appConstants.ITEM_DELETED_SUCCESSFULLY);i.bootstrapTable("refresh")}).catch(function(n){toastr.error(n.response.data.message)})})}}},{sortable:!0,searchable:!0,field:"name",title:"Name",width:100},{sortable:!0,searchable:!0,field:"graphType",title:"Graph Type",width:100},{sortable:!0,searchable:!0,field:"event",title:"Event",width:100},{sortable:!0,searchable:!0,field:"cohort",title:"Cohort",width:100}],onPageChange:function(t,i){var r=(t-1)*i,f=i;(n.offset!=r||n.limit!=f)&&(n.offset=r,n.limit=f,u())},onSort:function(t,i){n.sort=t;n.order=i;n.offset=0;u()},onRefresh:function(){c();u()},onSearch:function(t){n.filter=t;u()}})}function s(n){f.bootstrapTable("destroy");f.bootstrapTable({toolbar:"#tblToolbarPollDataPoints",uniqueId:"id",columns:[{title:"Actions",align:"center",width:50,formatter:function(){return`<a class="btn btn-danger btn-sm ml-2 remove" href="javascript:" title="Delete Poll Data">
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            </a>`},events:{"click .remove":function(n,t,i){n.preventDefault();f.bootstrapTable("removeByUniqueId",i.id)}}},{field:"name",title:"Name",width:100,editable:{type:"text"}},{field:"value",title:"Value",width:100,editable:{type:"text",tpl:'<input type="number" class="form-control input-sm" min="0" style="padding-right: 24px;">',validate:function(n){if(!n||!n.trim()||isNaN(parseInt(n))||parseInt(n)<0)return"Must be a positive integer."}}}],data:n});f.bootstrapTable("hideLoading")}function u(){i.bootstrapTable("showLoading");var t=$.param(n),r=`/api/polls?${t}`;axios.get(r).then(function(n){i.bootstrapTable("load",n.data);i.bootstrapTable("hideLoading")}).catch(function(n){toastr.error(n.response.data.Message)})}function c(){n.offset=0;n.limit=10;n.filter="";n.sort="name";n.order=""}function l(n){axios.get(`/api/polls/${n}`).then(function(n){t=n.data;setFormData(r,t);s(t.dataPoints);$("#poll-modal-label").text("Edit Poll");$("#poll-modal").modal("show")}).catch(function(n){showResponseError(n)})}function a(){axios.get(`/api/polls/new`).then(function(n){t=n.data;setFormData(r,t);s(t.dataPoints);$("#poll-modal").modal("show")}).catch(function(n){showResponseError(n)})}function v(n){n.preventDefault();var i=getMaxIdForArray(t.dataPoints,"id");t.dataPoints.push({id:i,pollId:t.id,name:"",value:0});f.bootstrapTable("load",t.dataPoints)}function y(n){var i;n.preventDefault();e&&e.destroy();try{var r=$("#graphTypeId").select2("data")[0].text,u=t.dataPoints.map(function(n){return parseInt(n.value)}),f=t.dataPoints.map(function(n){return n.name});r==graphTypes.PIE_CHART?(i={series:u,chart:{height:300,type:"pie"},labels:f,legend:{position:"top",horizontalAlign:"center"}},e=new ApexCharts(document.querySelector("#chart"),i),e.render()):r==graphTypes.BAR_CHART&&(i={series:[{data:u}],chart:{type:"bar",height:350},plotOptions:{bar:{horizontal:!0}},dataLabels:{enabled:!1},xaxis:{categories:f}},e=new ApexCharts(document.querySelector("#chart"),i),e.render())}catch(n){console.error(n);toastr.error("Can not generate graph.")}}function p(n){var f,e,s,i;if(n.preventDefault(),f=$(this),e=f.html(),setLoadingButton(f),initializeValidation(r,o),s=isValidForm(r,o),s){showValidationToast(s);resetLoadingButton(f,e);return}resetValidationState(r);i=formDataToJson(r);i.id=parseInt(i.id);i.graphTypeId=parseInt(i.graphTypeId);i.eventId=parseInt(i.eventId);i.dataPoints=t.dataPoints;i.dataPoints.forEach(function(n){n.value=parseFloat(n.value)});i.id<=0?axios.post("/api/polls",i).then(function(){toastr.success("Poll created successfully!");resetLoadingButton(f,e);$("#poll-modal").modal("hide");u()}).catch(function(n){resetLoadingButton(f,e);showResponseError(n)}):axios.put("/api/polls",i).then(function(){toastr.success("Poll updated successfully!");resetLoadingButton(f,e);$("#poll-modal").modal("hide");u()}).catch(function(n){resetLoadingButton(f,e);showResponseError(n)})}var i,f,r,t,e,o={name:{presence:!0,length:{maximum:100}},graphTypeId:{presence:!0},eventId:{presence:!0}},n={offset:0,limit:10,sort:"name",order:"",filter:""};$(document).ready(function(){i=$("#tblList");f=$("#tblPollDataPoints");h();u();r=$("#poll-form");$("#add-new-poll").click(a);$("#btn-save-poll").click(p);$("#add-data-point").click(v);$("#generate-graph").click(y)})})();